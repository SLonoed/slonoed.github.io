{"data":{"site":{"siteMetadata":{"title":"slonoed","author":"Dmitry Manannikov","siteUrl":"https://slonoed.net"}},"markdownRemark":{"id":"23b829d3-3f29-550f-8d70-2af35717f0d8","html":"<h2 id=\"what-is-this-about\"><a href=\"#what-is-this-about\" aria-label=\"what is this about permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>What is this about?</h2>\n<p>In this tutorial I’ll show how to create simple web application with server render inside JVM and Reactjs on frontend. All code was written in clojure and clojurescript and shares UI code between backend and frontend.</p>\n<p>I assume you already know something about clojure(script) and understand concept of reactjs. If not,  you may find this links helpfull.</p>\n<ul>\n<li><a href=\"http://www.braveclojure.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Clojure for the Brave and True</a> – nice book for one who wants to start with clojure</li>\n<li><a href=\"http://clojuredocs.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">clojuredocs.org</a> – online docs with examples and comments</li>\n<li><a href=\"http://clojurescriptkoans.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Clojurescript koans</a> – fun way to learn clojurescript</li>\n<li><a href=\"https://facebook.github.io/react/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Reactjs</a> – docs and tutorials</li>\n</ul>\n<p>I use OSX for coding. If you use defferent OS you migth need to change some commands. But code itself remains the same.</p>\n<p>You can find some links inside the text. I suggest you’ll read them briefly (I don’t include info you can find in documentation).</p>\n<h2 id=\"the-idea\"><a href=\"#the-idea\" aria-label=\"the idea permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>The idea</h2>\n<p>The app itself is very simple. It’s a list of books. You can click on the book to open a detailed view. You can click the “Add book” button to open the modal with a form.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/65643c3e9e3e0252a6bfed8f8b90b3f2/40612/app.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 40.07561436672968%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABXUlEQVQoz22R2Y6DMAxF+f9P6+uookBB7EsCYW9Ltzu+aafqw1gyWHZyfWI73uGAMIrhRyk8P0BZFMiyDEmSwPd9BGGMvRdifzgiy181mw+OCOMcP66PJE1R5DlycacQgaKskRQaSreYxhF936OqKpiuQ9dP0P0CZWZM84ppmsA7rGeVRl63GIYR8zyjbVs4dV1DKSUiRpIT7vc7LpcLOhHTnYEZJzyfT/wZY631S7QsUIvwKBDLuloQJ45jlGWJVgSapgEb0Fu5pCSXVA3GZf2IsSHFPM+ztPO8YFkWS2yfzA/nxUP5ew4skmIQuu16xePx+FAyJkAQBPaZq5CdTicLYwUZ0M/nM7Zts86Y8xuk+/V2+9DRSKgaZRfDxhS9yRljjH2Zw/lFUWTxv43z+M9IOAwDXNfFbrezwtx8Kptm3uGHXTgH+vr+c2PfeVtbX1smDWtsapcn42FMrV/f4Vw8xFr/AQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"App\"\n        title=\"App\"\n        src=\"/static/65643c3e9e3e0252a6bfed8f8b90b3f2/623ee/app.png\"\n        srcset=\"/static/65643c3e9e3e0252a6bfed8f8b90b3f2/816c5/app.png 148w,\n/static/65643c3e9e3e0252a6bfed8f8b90b3f2/c766b/app.png 295w,\n/static/65643c3e9e3e0252a6bfed8f8b90b3f2/623ee/app.png 590w,\n/static/65643c3e9e3e0252a6bfed8f8b90b3f2/e5345/app.png 885w,\n/static/65643c3e9e3e0252a6bfed8f8b90b3f2/7a439/app.png 1180w,\n/static/65643c3e9e3e0252a6bfed8f8b90b3f2/84fe0/app.png 1770w,\n/static/65643c3e9e3e0252a6bfed8f8b90b3f2/40612/app.png 2116w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a></p>\n<p>The most interesting is a server side render. When you click on add button URL changes to /add. When you click on book in list URL changes to /book_name. But nothing will be fetched from the server because of clientside render. However, when you reload the page with URL /add, the server renders all html <strong>include visible form</strong>. Why so overengineering? The key is speed. Your users don’t have to to wait until all the JS code arrives at the browser. They can see page immediately. And they also don’t have to wait the page reloading when they move across your app. Also, you can obtain nice bonuses like search engine availability.</p>\n<h2 id=\"prepare-the-stuff\"><a href=\"#prepare-the-stuff\" aria-label=\"prepare the stuff permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prepare the stuff</h2>\n<p>Firstly, you need to <a href=\"http://www.oracle.com/technetwork/java/javase/downloads/index.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">install Java</a>.\nSecondly, you need to <a href=\"http://leiningen.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">install lein tool</a>.</p>\n<h2 id=\"hello-world\"><a href=\"#hello-world\" aria-label=\"hello world permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Hello world</h2>\n<p>Inside you working directory call</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">lein new default books\n<span class=\"token function\">cd</span> books</code></pre></div>\n<p>Here is the structure of the project</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.\n├── CHANGELOG.md\n├── LICENSE\n├── README.md\n├── doc\n│   └── intro.md\n├── project.clj\n├── resources\n├── src\n│   └── books\n│       └── core.clj\n└── test\n    └── books\n        └── core_test.clj</code></pre></div>\n<p>Now start REPL</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">lein repl</code></pre></div>\n<p>And run these commands in REPL</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">(require &#39;books.core)\n(book.core/foo &quot;Best&quot;)</code></pre></div>\n<p>The output should be <code class=\"language-text\">Best Hello, World!</code>.</p>\n<h2 id=\"sharpen-tools\"><a href=\"#sharpen-tools\" aria-label=\"sharpen tools permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Sharpen tools</h2>\n<p>I prefer to write tools before coding. At first, add dependencies to <strong>project.clj</strong> file.</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">defproject</span> books <span class=\"token string\">\"0.1.0-SNAPSHOT\"</span>\n  <span class=\"token operator\">:description</span> <span class=\"token string\">\"Books list\"</span>\n  <span class=\"token operator\">:dependencies</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>org.clojure/tools.<span class=\"token keyword\">namespace</span> <span class=\"token string\">\"0.3.0-alpha2\"</span>\n                  <span class=\"token operator\">:exclusions</span> <span class=\"token punctuation\">[</span>org.clojure/tools.reader<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">[</span>javax.servlet/servlet-api <span class=\"token string\">\"2.5\"</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">[</span>http-kit <span class=\"token string\">\"2.2.0\"</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">[</span>compojure <span class=\"token string\">\"1.5.1\"</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">[</span>org.clojure/clojure <span class=\"token string\">\"1.9.0-alpha12\"</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">[</span>rum <span class=\"token string\">\"0.10.7\"</span> <span class=\"token operator\">:exclusions</span> <span class=\"token punctuation\">[</span>cljsjs/react cljsjs/react-dom<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">[</span>cljsjs/react-dom <span class=\"token string\">\"15.3.1-0\"</span> <span class=\"token operator\">:exclusions</span> <span class=\"token punctuation\">[</span>cljsjs/react<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">[</span>cljsjs/react-dom-server <span class=\"token string\">\"15.3.1-0\"</span> <span class=\"token operator\">:exclusions</span> <span class=\"token punctuation\">[</span>cljsjs/react<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">[</span>cljsjs/react-with-addons <span class=\"token string\">\"15.3.1-0\"</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">[</span>org.clojure/clojurescript <span class=\"token string\">\"1.9.229\"</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">[</span>hiccup <span class=\"token string\">\"1.0.5\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n  <span class=\"token operator\">:resource-paths</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"resources\"</span><span class=\"token punctuation\">]</span>\n  <span class=\"token operator\">:plugins</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>lein-figwheel <span class=\"token string\">\"0.5.7\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n  <span class=\"token operator\">:figwheel</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:css-dirs</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"resources/public/css\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span>\n  <span class=\"token operator\">:cljsbuild</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:builds</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token operator\">:id</span> <span class=\"token string\">\"exchange\"</span>\n                      <span class=\"token operator\">:source-paths</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"src/\"</span><span class=\"token punctuation\">]</span>\n                      <span class=\"token operator\">:compiler</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:main</span> <span class=\"token string\">\"books.client\"</span>\n                                 <span class=\"token operator\">:optimizations</span> <span class=\"token operator\">:none</span>\n                                 <span class=\"token operator\">:asset-path</span> <span class=\"token string\">\"/public/js/out\"</span>\n                                 <span class=\"token operator\">:output-to</span> <span class=\"token string\">\"resources/public/js/books.js\"</span>\n                                 <span class=\"token operator\">:output-dir</span> <span class=\"token string\">\"resources/public/js/out\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>When you start, REPL Leiningen automatically downloads the dependencies.</p>\n<p>Clojure REPL has one annoying thing – it starts long. That’s why we need the reloadable system. We will use separate namespace <strong>user</strong> to control our server in development. Just create file <strong>./src/user.clj</strong> with code</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">ns</span> user\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">:use</span> org.httpkit.server<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">:require</span> <span class=\"token punctuation\">[</span>books.core <span class=\"token operator\">:as</span> <span class=\"token number\">b</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">[</span>clojure.tools.<span class=\"token keyword\">namespace</span>.repl <span class=\"token operator\">:refer</span> <span class=\"token punctuation\">[</span>refresh<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defonce</span> server <span class=\"token punctuation\">(</span>atom <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> app <span class=\"token punctuation\">[</span>req<span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">{</span><span class=\"token operator\">:status</span>  <span class=\"token number\">200</span>\n     <span class=\"token operator\">:headers</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"Content-Type\"</span> <span class=\"token string\">\"text/html\"</span><span class=\"token punctuation\">}</span>\n     <span class=\"token operator\">:body</span>    <span class=\"token string\">\"hello HTTP!\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> go <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span>reset! server <span class=\"token punctuation\">(</span>run-server #<span class=\"token operator\">'app</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:port</span> <span class=\"token number\">8080</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> reset\n  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">when-not</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">nil?</span> @server<span class=\"token punctuation\">)</span>\n     <span class=\"token punctuation\">(</span>@server <span class=\"token operator\">:timeout</span> <span class=\"token number\">100</span><span class=\"token punctuation\">)</span>\n     <span class=\"token punctuation\">(</span>reset! server <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span>refresh <span class=\"token operator\">:after</span> <span class=\"token operator\">'user</span>/go<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"simple-web-server\"><a href=\"#simple-web-server\" aria-label=\"simple web server permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Simple web server</h2>\n<p> In your <strong>core.clj</strong> file add</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">ns</span> books.core<span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> app\n  <span class=\"token punctuation\">[</span>req<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">{</span><span class=\"token operator\">:status</span>  <span class=\"token number\">200</span>\n   <span class=\"token operator\">:headers</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"Content-Type\"</span> <span class=\"token string\">\"text/html\"</span><span class=\"token punctuation\">}</span>\n   <span class=\"token operator\">:body</span>    <span class=\"token string\">\"hello HTTP!\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now start REPL and call <code class=\"language-text\">(reset)</code>. It should start web server on port 8080.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/89e34ad40d17154e7bcbb6ed594c1e14/aa16c/hello-http.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 355px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 36.33802816901409%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABJ0lEQVQoz6WQbUvDMBSF8///jn5QEPHLcPMFZt/b2I1mbdPOotvarF3b7XgTGCjskwYe7k0459xLWDB7wWJ6j1f3DrfuBEHAEXKOIIzgeT68IITjeYbFMsEyEb+I+Dss14flkMaPwPjjE8TkBs/ONa6cB6zlGnmeIaZQ17HAteFtDsuy0ag9VNOgrms0RL3boSgKeH6A6XSGueWAJVmGVVmhqnYo0wJZnlNfQcoCksSCttC9ftPmRil0XYe2bQ2HwwGKBm22W2xpACvLEpuvT+z3Ch9kyilQSok4jmmyD9u26RtCCCGQULiiwL7vTdAZfR+GAQNVtqbANM0MPIqMSYu0YBxHHI9HU42B+LndJdgqSWiDCGKVYrmIkaUp/nPYpcfT6fRnvgHSiw80/oNrJgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Hello http browser image\"\n        title=\"Hello http\"\n        src=\"/static/89e34ad40d17154e7bcbb6ed594c1e14/aa16c/hello-http.png\"\n        srcset=\"/static/89e34ad40d17154e7bcbb6ed594c1e14/4a002/hello-http.png 148w,\n/static/89e34ad40d17154e7bcbb6ed594c1e14/eeebf/hello-http.png 295w,\n/static/89e34ad40d17154e7bcbb6ed594c1e14/aa16c/hello-http.png 355w\"\n        sizes=\"(max-width: 355px) 100vw, 355px\"\n      />\n  </span>\n  </a></p>\n<p>From this point you can use code reload without restarting REPL. Try to change response body from hello HTTP! to hello clojure! and call <code class=\"language-text\">(reset)</code> inside REPL.</p>\n<p><a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/52280341a7e9f8fca462806fa38856d7/2d8e5/hello-clojure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 343px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 35.8600583090379%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABLklEQVQoz52Q3U6DQBCF9/0fxpteGmMTY4ym1AgU6IJQfnahQKGlAgWaHnc31rte6CQnM9mdOfNlCJ0/IXye4dWc4c54AHU8eP4n1tTFarWC7azxoRtYaEsEmxA8TcE4/1GKKI5FD8W76NFNC8R707BZzLG0HnFvvSBPc2RZBk8Y2pYJSikcx4Gh66iqGm37hcPhoNQ0DYo8RyxMF5qmlpJNkoAXO9TVETnbIooiFEWBTJBwQREEgaIqywKx6K3rPaZpwjAMSrKW6rpOLGtB5GBdVzgeG5S7UtHlcmsYwrZtGIapCBljSBKGvSAbxxGn00kZynyt5TvZZltwxhUVE1kuaNsO5/MZl8sFMmS+ksjBvu9vivi+D5d66g6moHHFzYZx+jX6a5BbH9LsP/oGnHsPqiF4T/EAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Hello clojure browser image\"\n        title=\"Hello clojure\"\n        src=\"/static/52280341a7e9f8fca462806fa38856d7/2d8e5/hello-clojure.png\"\n        srcset=\"/static/52280341a7e9f8fca462806fa38856d7/a586b/hello-clojure.png 148w,\n/static/52280341a7e9f8fca462806fa38856d7/a0be9/hello-clojure.png 295w,\n/static/52280341a7e9f8fca462806fa38856d7/2d8e5/hello-clojure.png 343w\"\n        sizes=\"(max-width: 343px) 100vw, 343px\"\n      />\n  </span>\n  </a></p>\n<h2 id=\"routing\"><a href=\"#routing\" aria-label=\"routing permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Routing</h2>\n<p>http-kit plays well with Compojure. We need few server routes.</p>\n<ul>\n<li>books list route</li>\n<li>book route</li>\n<li>add book form route</li>\n<li>add book route</li>\n<li>static files route</li>\n<li>not found route</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token comment\">;; src/books/core.clj</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">ns</span> books.core\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">:use</span> <span class=\"token punctuation\">[</span>compojure.route <span class=\"token operator\">:only</span> <span class=\"token punctuation\">[</span>files not-found<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">[</span>compojure.handler <span class=\"token operator\">:only</span> <span class=\"token punctuation\">[</span>site<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">[</span>compojure.core <span class=\"token operator\">:only</span> <span class=\"token punctuation\">[</span>defroutes GET POST DELETE ANY context<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n        org.httpkit.server<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">; App route</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> render\n  <span class=\"token punctuation\">[</span>req<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">{</span><span class=\"token operator\">:status</span>  <span class=\"token number\">200</span>\n   <span class=\"token operator\">:headers</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"Content-Type\"</span> <span class=\"token string\">\"text/html\"</span><span class=\"token punctuation\">}</span>\n   <span class=\"token operator\">:body</span>    <span class=\"token string\">\"hello clojure!\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> <span class=\"token number\">add</span>-book\n  <span class=\"token punctuation\">[</span>req<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">{</span><span class=\"token operator\">:status</span> <span class=\"token number\">201</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>defroutes all-routes\n  <span class=\"token punctuation\">(</span>GET <span class=\"token string\">\"/\"</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> render<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span>GET <span class=\"token string\">\"/:route\"</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> render<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span>POST <span class=\"token string\">\"/\"</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token number\">add</span>-book<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span>files <span class=\"token string\">\"/public/\"</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:root</span> <span class=\"token string\">\"resources/public\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span>not-found <span class=\"token string\">\"Page not found\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">def</span> app <span class=\"token punctuation\">(</span>site all-routes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"prepare-fronted\"><a href=\"#prepare-fronted\" aria-label=\"prepare fronted permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Prepare fronted</h2>\n<p>Now we need to setup frontend part (javascript + css).\nCreate file <code class=\"language-text\">resources/public/css/books.css</code> and put some css there (I don’t wont to cover css styling here, this part is up to you).\nNow prepare page HTML with <a href=\"https://github.com/weavejester/hiccup\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">hiccup</a>. Add code to render method.</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> render\n  <span class=\"token punctuation\">[</span>req<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">{</span><span class=\"token operator\">:status</span>  <span class=\"token number\">200</span>\n   <span class=\"token operator\">:headers</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"Content-Type\"</span> <span class=\"token string\">\"text/html\"</span><span class=\"token punctuation\">}</span>\n   <span class=\"token operator\">:body</span>    <span class=\"token punctuation\">(</span>hiccup/html\n              <span class=\"token string\">\"&lt;!doctype html>\"</span>\n              <span class=\"token punctuation\">[</span><span class=\"token operator\">:html</span>\n               <span class=\"token punctuation\">[</span><span class=\"token operator\">:head</span>\n                <span class=\"token punctuation\">[</span><span class=\"token operator\">:link</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:rel</span> <span class=\"token string\">\"stylesheet\"</span> <span class=\"token operator\">:media</span> <span class=\"token string\">\"screen\"</span>\n                        <span class=\"token operator\">:href</span>  <span class=\"token string\">\"/public/css/books.css\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n               <span class=\"token punctuation\">[</span><span class=\"token operator\">:body</span>\n                <span class=\"token punctuation\">[</span><span class=\"token operator\">:div</span>#application\n                 <span class=\"token string\">\"PLACE FOR GENERATED HTML\"</span><span class=\"token punctuation\">]</span>\n                <span class=\"token punctuation\">[</span><span class=\"token operator\">:script</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:src</span> <span class=\"token string\">\"/public/js/books.js\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n                <span class=\"token punctuation\">[</span><span class=\"token operator\">:script</span>\n                 <span class=\"token string\">\"books.client.init()\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Then create file <strong>src/books/client.cljs</strong> (note file extension <strong>cljs</strong>) with content</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">ns</span> books.client<span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> init\n  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span>js/console.log <span class=\"token string\">\"App ready\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Now call <code class=\"language-text\">(reset)</code> in REPL and start <strong>different</strong> REPL for clojurescript build.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">lein figwheel</code></pre></div>\n<p>If you reload browser you will see “App ready” message in browser console.\nСongratulations! Now we can write some code (:</p>\n<h2 id=\"books-list\"><a href=\"#books-list\" aria-label=\"books list permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Books list</h2>\n<p>We will store all books is one vector (wrapped in atom). Each item is the vector with title, year, author. Place this code in <code class=\"language-text\">core.src</code> files after <code class=\"language-text\">ns</code> form.</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">defonce</span> books <span class=\"token punctuation\">(</span>atom <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"The Old Man and the Sea\"</span> <span class=\"token number\">1952</span> <span class=\"token string\">\"Ernest Hemingway\"</span><span class=\"token punctuation\">]</span>\n                      <span class=\"token punctuation\">[</span><span class=\"token string\">\"Hyperion\"</span> <span class=\"token number\">1989</span> <span class=\"token string\">\"Dan Simmons\"</span><span class=\"token punctuation\">]</span>\n                      <span class=\"token punctuation\">[</span><span class=\"token string\">\"The 7 Habits of Highly Effective People\"</span> <span class=\"token number\">1989</span> <span class=\"token string\">\"Stephen Covey\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"components-and-server-render\"><a href=\"#components-and-server-render\" aria-label=\"components and server render permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Components and server render</h2>\n<p>A component can be taken from closure and closurescript. To achieve it we’ll use <a href=\"http://clojure.org/guides/reader_conditionals\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">reader conditional</a>. In short: this language feature allows you to mark some code forms only for each or other language. Create file <strong>src/books/components.cljc</strong> (note <strong>cljc</strong> extension) with this code.</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">ns</span> books.components\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">:require</span> <span class=\"token punctuation\">[</span>rum.core <span class=\"token operator\">:as</span> r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>r/<span class=\"token number\">defc</span> link <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>title year author<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">[</span><span class=\"token operator\">:li</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:key</span> title<span class=\"token punctuation\">}</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:a</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:href</span> title<span class=\"token punctuation\">}</span> title<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>r/<span class=\"token number\">defc</span> books-list <span class=\"token punctuation\">[</span>books<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">[</span>:.<span class=\"token keyword\">list</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:ul</span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">map</span> link books<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:a</span>.btn <span class=\"token punctuation\">{</span><span class=\"token operator\">:href</span> <span class=\"token string\">\"/add\"</span><span class=\"token punctuation\">}</span> <span class=\"token string\">\"Add book\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>r/<span class=\"token number\">defc</span> details <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>title year author<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">[</span>:.details\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:a</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:href</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">}</span> <span class=\"token string\">\"List\"</span><span class=\"token punctuation\">]</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:label</span> <span class=\"token string\">\"Title\"</span><span class=\"token punctuation\">]</span> title\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:label</span> <span class=\"token string\">\"Author\"</span><span class=\"token punctuation\">]</span> author\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:label</span> <span class=\"token string\">\"Year\"</span><span class=\"token punctuation\">]</span> year<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>r/<span class=\"token number\">defc</span> <span class=\"token number\">add</span>-form <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">[</span>:.modal\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:form</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:action</span> <span class=\"token string\">\"/\"</span> <span class=\"token operator\">:method</span> <span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">:input</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:type</span> <span class=\"token string\">\"text\"</span> <span class=\"token operator\">:name</span> <span class=\"token string\">\"title\"</span>  <span class=\"token operator\">:placeholder</span> <span class=\"token string\">\"Title\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">:input</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:type</span> <span class=\"token string\">\"text\"</span> <span class=\"token operator\">:name</span> <span class=\"token string\">\"author\"</span> <span class=\"token operator\">:placeholder</span> <span class=\"token string\">\"Author\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">:input</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:type</span> <span class=\"token string\">\"text\"</span> <span class=\"token operator\">:name</span> <span class=\"token string\">\"year\"</span>   <span class=\"token operator\">:placeholder</span> <span class=\"token string\">\"Year\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">:button</span>.btn <span class=\"token punctuation\">{</span><span class=\"token operator\">:type</span> <span class=\"token string\">\"submit\"</span><span class=\"token punctuation\">}</span> <span class=\"token string\">\"Add\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">:a</span>.btn <span class=\"token punctuation\">{</span><span class=\"token operator\">:href</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">}</span> <span class=\"token string\">\"Cancel\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>r/<span class=\"token number\">defc</span> app <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token operator\">:keys</span> <span class=\"token punctuation\">[</span>books route<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">[</span>:.page\n   <span class=\"token comment\">;; If route match any book title - show detailed view</span>\n   <span class=\"token comment\">;; else - show list</span>\n   <span class=\"token punctuation\">(</span><span class=\"token keyword\">if-let</span> <span class=\"token punctuation\">[</span>book <span class=\"token punctuation\">(</span><span class=\"token keyword\">some</span> #<span class=\"token punctuation\">(</span><span class=\"token keyword\">when</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">=</span> route <span class=\"token punctuation\">(</span><span class=\"token keyword\">first</span> %<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> %<span class=\"token punctuation\">)</span> books<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n     <span class=\"token punctuation\">(</span>details book<span class=\"token punctuation\">)</span>\n     <span class=\"token punctuation\">(</span>books-list books<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   <span class=\"token comment\">;; If route is \"add\" – render additional modal window with form</span>\n   <span class=\"token punctuation\">(</span><span class=\"token keyword\">when</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">=</span> route <span class=\"token string\">\"add\"</span><span class=\"token punctuation\">)</span>\n     <span class=\"token punctuation\">(</span><span class=\"token number\">add</span>-form<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>In <strong>core.clj</strong> use <code class=\"language-text\">rum.core/render-html</code> to render this component. And update code of <code class=\"language-text\">add-book</code> function. It should receive form data, write to books atom and redirect to list.</p>\n<p>Updated code:</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">ns</span> books.core\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">:require</span> <span class=\"token punctuation\">[</span>hiccup.core <span class=\"token operator\">:as</span> hiccup<span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">[</span>rum.core <span class=\"token operator\">:as</span> r<span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">[</span>books.components <span class=\"token operator\">:as</span> <span class=\"token number\">c</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">:use</span> <span class=\"token punctuation\">[</span>compojure.route <span class=\"token operator\">:only</span> <span class=\"token punctuation\">[</span>files not-found<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">[</span>compojure.handler <span class=\"token operator\">:only</span> <span class=\"token punctuation\">[</span>site<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n        <span class=\"token punctuation\">[</span>compojure.core <span class=\"token operator\">:only</span> <span class=\"token punctuation\">[</span>defroutes GET POST DELETE ANY context<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n        org.httpkit.server<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defonce</span> books <span class=\"token punctuation\">(</span>atom <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"The Old Man and the Sea\"</span> <span class=\"token number\">1952</span> <span class=\"token string\">\"Ernest Hemingway\"</span><span class=\"token punctuation\">]</span>\n                      <span class=\"token punctuation\">[</span><span class=\"token string\">\"Hyperion\"</span> <span class=\"token number\">1989</span> <span class=\"token string\">\"Dan Simmons\"</span><span class=\"token punctuation\">]</span>\n                      <span class=\"token punctuation\">[</span><span class=\"token string\">\"The 7 Habits of Highly Effective People\"</span> <span class=\"token number\">1989</span> <span class=\"token string\">\"Stephen Covey\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> render\n  <span class=\"token punctuation\">[</span>\\<span class=\"token punctuation\">{</span>\\<span class=\"token punctuation\">{</span>route <span class=\"token operator\">:route</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">:route-params</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">{</span><span class=\"token operator\">:status</span>  <span class=\"token number\">200</span>\n   <span class=\"token operator\">:headers</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"Content-Type\"</span> <span class=\"token string\">\"text/html\"</span><span class=\"token punctuation\">}</span>\n   <span class=\"token operator\">:body</span>    <span class=\"token punctuation\">(</span>hiccup/html\n              <span class=\"token string\">\"&lt;!doctype html>\"</span>\n              <span class=\"token punctuation\">[</span><span class=\"token operator\">:html</span>\n               <span class=\"token punctuation\">[</span><span class=\"token operator\">:head</span>\n                <span class=\"token punctuation\">[</span><span class=\"token operator\">:meta</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:charset</span> <span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n                <span class=\"token punctuation\">[</span><span class=\"token operator\">:link</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:rel</span> <span class=\"token string\">\"stylesheet\"</span> <span class=\"token operator\">:media</span> <span class=\"token string\">\"screen\"</span>\n                        <span class=\"token operator\">:href</span>  <span class=\"token string\">\"/public/css/books.css\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n               <span class=\"token punctuation\">[</span><span class=\"token operator\">:body</span>\n                <span class=\"token punctuation\">[</span><span class=\"token operator\">:div</span>#application\n                 <span class=\"token punctuation\">(</span>r/render-html <span class=\"token punctuation\">(</span><span class=\"token number\">c</span>/app <span class=\"token punctuation\">{</span><span class=\"token operator\">:route</span> route\n                                        <span class=\"token operator\">:books</span> @books<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n                <span class=\"token punctuation\">[</span><span class=\"token operator\">:script</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:src</span> <span class=\"token string\">\"/public/js/books.js\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n                <span class=\"token punctuation\">[</span><span class=\"token operator\">:script</span>\n                 <span class=\"token string\">\"books.client.init()\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> <span class=\"token number\">add</span>-book\n  <span class=\"token punctuation\">[</span>\\<span class=\"token punctuation\">{</span>\\<span class=\"token punctuation\">{</span><span class=\"token operator\">:strs</span> <span class=\"token punctuation\">[</span>title author year<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">:form-params</span> <span class=\"token operator\">:as</span> req<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span>swap! books <span class=\"token keyword\">conj</span> <span class=\"token punctuation\">[</span>title year author<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">{</span><span class=\"token operator\">:status</span> <span class=\"token number\">303</span>\n   <span class=\"token operator\">:headers</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"Location\"</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>defroutes all-routes\n  <span class=\"token punctuation\">(</span>GET <span class=\"token string\">\"/\"</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> render<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span>GET <span class=\"token string\">\"/:route\"</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> render<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span>POST <span class=\"token string\">\"/\"</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> <span class=\"token number\">add</span>-book<span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span>files <span class=\"token string\">\"/public/\"</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:root</span> <span class=\"token string\">\"resources/public\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span>not-found <span class=\"token string\">\"Page not found\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">def</span> app <span class=\"token punctuation\">(</span>site all-routes<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Don’t forget to write some styles in <code class=\"language-text\">resources/public/css/books.css</code>. You can get some from <a href=\"https://github.com/slonoed/rum-server-render-example/blob/master/resources/public/css/books.css\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">repo</a>\nCall <code class=\"language-text\">(reset)</code> in clojure REPL and refresh browser page. Now we get simple web app that works without javascript.</p>\n<h2 id=\"add-client-logic\"><a href=\"#add-client-logic\" aria-label=\"add client logic permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Add client logic</h2>\n<p>To sync html from server and react DOM tree in browser we need to pass all the state that we use for rendering html to browser. And then apply this state to reactjs tree. To simplify work with links I handle all link in one handler. In real app you probably want to create separate actions. Create file <strong>src/controllers.cljs</strong> with this content:</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">ns</span> books.controllers\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">:import</span> <span class=\"token punctuation\">[</span>goog.history Html5History EventType<span class=\"token punctuation\">]</span>\n           <span class=\"token punctuation\">[</span>goog History<span class=\"token punctuation\">]</span>\n           <span class=\"token punctuation\">[</span>goog.net XhrIo<span class=\"token punctuation\">]</span>\n           <span class=\"token punctuation\">[</span>goog.date Date<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defonce</span> state <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defonce</span> history <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> local-link?\n  \"Check DOM <span class=\"token keyword\">node</span> is <span class=\"token operator\">'A</span>' link to local address\n  Like &lt;<span class=\"token number\">a</span> href='/<span class=\"token number\">add</span>'>link&lt;/<span class=\"token number\">a</span>>\n  \"\n  <span class=\"token punctuation\">[</span><span class=\"token number\">a</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">and</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">=</span> <span class=\"token punctuation\">(</span>.-tagName <span class=\"token number\">a</span><span class=\"token punctuation\">)</span> <span class=\"token string\">\"A\"</span><span class=\"token punctuation\">)</span>\n       <span class=\"token punctuation\">(</span>goog.string/startsWith <span class=\"token punctuation\">(</span>.-href <span class=\"token number\">a</span><span class=\"token punctuation\">)</span>\n                               <span class=\"token punctuation\">(</span><span class=\"token keyword\">str</span>\n                                 js/location.protocol\n                                 <span class=\"token string\">\"//\"</span>\n                                 js/location.host<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> handle-url-change\n  <span class=\"token string\">\"set :route field in state when routing changed\"</span>\n  <span class=\"token punctuation\">[</span><span class=\"token number\">e</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>t <span class=\"token punctuation\">(</span>.slice <span class=\"token punctuation\">(</span>.-token <span class=\"token number\">e</span><span class=\"token punctuation\">)</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span>\n        t' <span class=\"token punctuation\">(</span>js/decodeURIComponent t<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">(</span>swap! state <span class=\"token keyword\">assoc</span> <span class=\"token operator\">:route</span> t'<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> start!\n  <span class=\"token string\">\"Start function. Expects state map\"</span>\n  <span class=\"token punctuation\">[</span>state'<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">set!</span> state state'<span class=\"token punctuation\">)</span>\n  <span class=\"token comment\">;; Setup history</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">set!</span> history <span class=\"token punctuation\">(</span>Html5History.<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">doto</span> history\n    <span class=\"token punctuation\">(</span>.setPathPrefix <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">(</span>.setUseFragment <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">(</span>goog.events/listen EventType.NAVIGATE\n                        #<span class=\"token punctuation\">(</span>handle-url-change %<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">(</span>.setEnabled <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">;; Small hack. When use click link on page we check is this same domain link</span>\n<span class=\"token comment\">;; and instead reloading page only change history</span>\n<span class=\"token punctuation\">(</span>goog.events/listen js/document.body <span class=\"token string\">\"click\"</span>\n                    <span class=\"token punctuation\">(</span><span class=\"token keyword\">fn</span> <span class=\"token punctuation\">[</span><span class=\"token number\">e</span><span class=\"token punctuation\">]</span>\n                      <span class=\"token punctuation\">(</span><span class=\"token keyword\">when</span> <span class=\"token punctuation\">(</span>local-link? <span class=\"token punctuation\">(</span>.-target <span class=\"token number\">e</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">(</span>.preventDefault <span class=\"token number\">e</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">(</span>.setToken history <span class=\"token punctuation\">(</span><span class=\"token keyword\">..</span> <span class=\"token number\">e</span> -target -pathname<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> <span class=\"token number\">add</span>-book\n  <span class=\"token string\">\"Save book to server. After success redirect to list page.\"</span>\n  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>title year author <span class=\"token operator\">:as</span> book<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>esc #<span class=\"token punctuation\">(</span>js/encodeURIComponent %<span class=\"token punctuation\">)</span>\n        form-data <span class=\"token punctuation\">(</span><span class=\"token keyword\">str</span> <span class=\"token string\">\"title=\"</span> <span class=\"token punctuation\">(</span>esc title<span class=\"token punctuation\">)</span> <span class=\"token string\">\"&amp;\"</span>\n                       <span class=\"token string\">\"year=\"</span> <span class=\"token punctuation\">(</span>esc title<span class=\"token punctuation\">)</span> <span class=\"token string\">\"&amp;\"</span>\n                       <span class=\"token string\">\"author=\"</span> <span class=\"token punctuation\">(</span>esc author<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n        callback <span class=\"token punctuation\">(</span><span class=\"token keyword\">fn</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n                   <span class=\"token punctuation\">(</span>swap! state update <span class=\"token operator\">:books</span> <span class=\"token keyword\">conj</span> book<span class=\"token punctuation\">)</span>\n                   <span class=\"token punctuation\">(</span>.setToken history <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">(</span>.<span class=\"token keyword\">send</span> XhrIo <span class=\"token string\">\"/\"</span> callback <span class=\"token string\">\"POST\"</span> form-data<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>In <strong>core.clj</strong> change <code class=\"language-text\">render</code> to provide state for client code.</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> render\n  <span class=\"token punctuation\">[</span>\\<span class=\"token punctuation\">{</span>\\<span class=\"token punctuation\">{</span>route <span class=\"token operator\">:route</span><span class=\"token punctuation\">}</span> <span class=\"token operator\">:route-params</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>state <span class=\"token punctuation\">{</span><span class=\"token operator\">:route</span> route\n               <span class=\"token operator\">:books</span> @books<span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">{</span><span class=\"token operator\">:status</span>  <span class=\"token number\">200</span>\n    <span class=\"token operator\">:headers</span> <span class=\"token punctuation\">{</span><span class=\"token string\">\"Content-Type\"</span> <span class=\"token string\">\"text/html\"</span><span class=\"token punctuation\">}</span>\n    <span class=\"token operator\">:body</span>    <span class=\"token punctuation\">(</span>hiccup/html\n               <span class=\"token string\">\"&lt;!doctype html>\"</span>\n               <span class=\"token punctuation\">[</span><span class=\"token operator\">:html</span>\n                <span class=\"token punctuation\">[</span><span class=\"token operator\">:head</span>\n                 <span class=\"token punctuation\">[</span><span class=\"token operator\">:meta</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:charset</span> <span class=\"token string\">\"utf-8\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">[</span><span class=\"token operator\">:link</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:rel</span> <span class=\"token string\">\"stylesheet\"</span> <span class=\"token operator\">:media</span> <span class=\"token string\">\"screen\"</span>\n                         <span class=\"token operator\">:href</span>  <span class=\"token string\">\"/public/css/books.css\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n                <span class=\"token punctuation\">[</span><span class=\"token operator\">:body</span>\n                 <span class=\"token punctuation\">[</span><span class=\"token operator\">:div</span>#application\n                  <span class=\"token punctuation\">(</span>r/render-html <span class=\"token punctuation\">(</span><span class=\"token number\">c</span>/app state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token comment\">;; Serialize data for client</span>\n                 <span class=\"token punctuation\">[</span><span class=\"token operator\">:script</span>#initial-data <span class=\"token punctuation\">{</span><span class=\"token operator\">:type</span> <span class=\"token string\">\"application/edn\"</span><span class=\"token punctuation\">}</span>\n                  <span class=\"token punctuation\">(</span><span class=\"token keyword\">pr-str</span> state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">[</span><span class=\"token operator\">:script</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:src</span> <span class=\"token string\">\"/public/js/books.js\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n                 <span class=\"token punctuation\">[</span><span class=\"token operator\">:script</span>\n                  <span class=\"token string\">\"books.client.init()\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>In <strong>client.cljs</strong> tie it together:</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">ns</span> books.client\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">:require</span> <span class=\"token punctuation\">[</span>books.controllers <span class=\"token operator\">:as</span> ctrls<span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">[</span>books.components <span class=\"token operator\">:as</span> <span class=\"token number\">c</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">[</span>rum.core <span class=\"token operator\">:as</span> r<span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">[</span>cljs.reader <span class=\"token operator\">:as</span> reader<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> load-init-state <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span>reader/read-string <span class=\"token punctuation\">(</span>.-text <span class=\"token punctuation\">(</span>js/document.getElementById <span class=\"token string\">\"initial-data\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>r/<span class=\"token number\">defc</span> wrapper <span class=\"token keyword\">&lt;</span> r/reactive\n  <span class=\"token punctuation\">[</span>s<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span><span class=\"token number\">c</span>/app <span class=\"token punctuation\">(</span>r/react s<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> init\n  <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span>init-state <span class=\"token punctuation\">(</span>atom <span class=\"token punctuation\">(</span>load-init-state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">(</span>r/mount <span class=\"token punctuation\">(</span>wrapper init-state<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>js/document.getElementById <span class=\"token string\">\"application\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">(</span>ctrls/start! init-state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>The last step is to put the submit handler on form (<strong>components.cljc</strong>). Note changed <code class=\"language-text\">ns</code> form. And form <code class=\"language-text\">on-change</code> property.</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">ns</span> books.components\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">:require</span> <span class=\"token punctuation\">[</span>rum.core <span class=\"token operator\">:as</span> r<span class=\"token punctuation\">]</span>\n            #?<span class=\"token punctuation\">(</span><span class=\"token operator\">:cljs</span> <span class=\"token punctuation\">[</span>books.controllers <span class=\"token operator\">:as</span> <span class=\"token number\">c</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">;; there are no controllers in clojure</span>\n\n<span class=\"token punctuation\">(</span>r/<span class=\"token number\">defc</span> link <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>title year author<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">[</span><span class=\"token operator\">:li</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:a</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:href</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">str</span> <span class=\"token string\">\"/\"</span> title<span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span> title<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>r/<span class=\"token number\">defc</span> books-list <span class=\"token punctuation\">[</span>books<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">[</span>:.<span class=\"token keyword\">list</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:ul</span>\n    <span class=\"token punctuation\">(</span><span class=\"token keyword\">map</span> link books<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:a</span>.btn <span class=\"token punctuation\">{</span><span class=\"token operator\">:href</span> <span class=\"token string\">\"/add\"</span><span class=\"token punctuation\">}</span> <span class=\"token string\">\"Add book\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>r/<span class=\"token number\">defc</span> details <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>title year author<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">[</span>:.details\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:a</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:href</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">}</span> <span class=\"token string\">\"List\"</span><span class=\"token punctuation\">]</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:label</span> <span class=\"token string\">\"Title\"</span><span class=\"token punctuation\">]</span> title\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:label</span> <span class=\"token string\">\"Author\"</span><span class=\"token punctuation\">]</span> author\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:label</span> <span class=\"token string\">\"Year\"</span><span class=\"token punctuation\">]</span> year<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>r/<span class=\"token number\">defc</span> <span class=\"token number\">add</span>-form <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">[</span>:.modal\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:form</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:action</span> <span class=\"token string\">\"/\"</span>\n           <span class=\"token operator\">:method</span> <span class=\"token string\">\"POST\"</span>\n           <span class=\"token operator\">:on-submit</span> #?<span class=\"token punctuation\">(</span><span class=\"token operator\">:clj</span> <span class=\"token boolean\">nil</span>\n                         <span class=\"token comment\">;; We need handler only in cljs</span>\n                         <span class=\"token operator\">:cljs</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">fn</span> <span class=\"token punctuation\">[</span><span class=\"token number\">e</span><span class=\"token punctuation\">]</span>\n                                 <span class=\"token punctuation\">(</span>.preventDefault <span class=\"token number\">e</span><span class=\"token punctuation\">)</span>\n                                 <span class=\"token punctuation\">(</span><span class=\"token number\">c</span>/<span class=\"token number\">add</span>-book <span class=\"token punctuation\">[</span><span class=\"token string\">\"Hello\"</span> <span class=\"token number\">12324</span> <span class=\"token string\">\"Dmitry\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">:input</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:type</span> <span class=\"token string\">\"text\"</span> <span class=\"token operator\">:name</span> <span class=\"token string\">\"title\"</span>  <span class=\"token operator\">:placeholder</span> <span class=\"token string\">\"Title\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">:input</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:type</span> <span class=\"token string\">\"text\"</span> <span class=\"token operator\">:name</span> <span class=\"token string\">\"author\"</span> <span class=\"token operator\">:placeholder</span> <span class=\"token string\">\"Author\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">:input</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:type</span> <span class=\"token string\">\"text\"</span> <span class=\"token operator\">:name</span> <span class=\"token string\">\"year\"</span>   <span class=\"token operator\">:placeholder</span> <span class=\"token string\">\"Year\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">:button</span>.btn <span class=\"token punctuation\">{</span><span class=\"token operator\">:type</span> <span class=\"token string\">\"submit\"</span><span class=\"token punctuation\">}</span> <span class=\"token string\">\"Add\"</span><span class=\"token punctuation\">]</span>\n    <span class=\"token punctuation\">[</span><span class=\"token operator\">:a</span>.btn <span class=\"token punctuation\">{</span><span class=\"token operator\">:href</span> <span class=\"token string\">\"/\"</span><span class=\"token punctuation\">}</span> <span class=\"token string\">\"Cancel\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>r/<span class=\"token number\">defc</span> app <span class=\"token punctuation\">[</span><span class=\"token punctuation\">{</span><span class=\"token operator\">:keys</span> <span class=\"token punctuation\">[</span>books route<span class=\"token punctuation\">]</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">[</span>:.page\n   <span class=\"token comment\">;; If route match any book title - show detailed view</span>\n   <span class=\"token comment\">;; else - show list</span>\n   <span class=\"token punctuation\">(</span><span class=\"token keyword\">if-let</span> <span class=\"token punctuation\">[</span>book <span class=\"token punctuation\">(</span><span class=\"token keyword\">some</span> #<span class=\"token punctuation\">(</span><span class=\"token keyword\">when</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">=</span> route <span class=\"token punctuation\">(</span><span class=\"token keyword\">first</span> %<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> %<span class=\"token punctuation\">)</span> books<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n     <span class=\"token punctuation\">(</span>details book<span class=\"token punctuation\">)</span>\n     <span class=\"token punctuation\">(</span>books-list books<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n   <span class=\"token comment\">;; If route is \"add\" – render additional modal window with form</span>\n   <span class=\"token punctuation\">(</span><span class=\"token keyword\">when</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">=</span> route <span class=\"token string\">\"add\"</span><span class=\"token punctuation\">)</span>\n     <span class=\"token punctuation\">(</span><span class=\"token number\">add</span>-form<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></code></pre></div>\n<h2 id=\"tips-notes-pitfalls\"><a href=\"#tips-notes-pitfalls\" aria-label=\"tips notes pitfalls permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Tips, notes, pitfalls</h2>\n<p>You can find all code in <a href=\"https://github.com/slonoed/rum-server-render-example\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">repo</a>.</p>\n<p>This report shows only the basics of rum. I skip few useful topics. It’s <a href=\"https://github.com/tonsky/rum\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">documentation</a> pretty good.</p>\n<p>I didn’t mention about hot reload at all. I think you can find more in <a href=\"https://github.com/bhauman/lein-figwheel\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">figwheel documentation</a>.</p>\n<p>Trick with links only for this demonstration. In a real app you should handle all the links carefully.</p>\n<p>In a huge app direct changing state can create mess. To prevent from it you can use redux like technique. You can create <a href=\"https://clojure.github.io/core.async/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">core.async/chan</a>, put any actions to it and create infinite loop to handle this action and change state.</p>\n<p>Be careful when you use some float number functions in components. For example Math.sin in Java and Javascript looks the same, but can produce slightly different numbers. If it happens, react will rerender node.</p>\n<h2 id=\"questions\"><a href=\"#questions\" aria-label=\"questions permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Questions</h2>\n<p>If you have any questions or have found any mistakes in this text, please write me message in <a href=\"http://twitter.com/slonoed\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">twitter</a>.</p>","timeToRead":11,"frontmatter":{"title":"Clojure render react","date":"November 14, 2016","description":null},"fields":{"slug":"/clojure-render-react/","langKey":"en"}},"altPost":null},"pageContext":{"slug":"/clojure-render-react/","altSlug":"/ru/clojure-render-react/"}}