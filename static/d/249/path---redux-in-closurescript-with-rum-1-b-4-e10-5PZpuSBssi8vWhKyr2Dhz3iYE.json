{"data":{"site":{"siteMetadata":{"title":"slonoed","author":"Dmitry Manannikov","siteUrl":"https://slonoed.net"}},"markdownRemark":{"id":"1e97d573-d08c-54ed-891a-27794142fe3c","html":"<p>Keeping consistent code in your app is hard task. Keeping consistent code in your team’s app even harder. People love redux for two features:\nFirstly, it is simple. If you don’t use some weird libraries redux is about one object and few functions.\nSecondly, it provides strict understanding where the things should be. You have one place for state, one place for changing state (well, really you have bunch of reducers) and place for async logic (action creators).\nOther features like hot reload, state history, one way data flow you get for free.</p>\n<p>I want to show you how to achieve same profits with clojurescript and run library, using native language constructions and stdlib methods.</p>\n<p>This post targets developers who already familiar with react, clojure and figwheel. If you are not, check these links</p>\n<ul>\n<li><a href=\"http://www.braveclojure.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Clojure for the Brave and True</a> – nice book for one who wants to start with clojure</li>\n<li><a href=\"http://clojuredocs.org/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">clojuredocs.org</a> – online docs with examples and comments</li>\n<li><a href=\"http://clojurescriptkoans.com/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Clojurescript koans</a> – fun way to learn clojurescript</li>\n<li><a href=\"https://facebook.github.io/react/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Reactjs</a> – docs and tutorials</li>\n<li><a href=\"https://medium.com/@roman01la/how-to-create-clojurescript-app-4e38778c4762\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">How to Create ClojureScript App</a></li>\n</ul>\n<p>I use the <a href=\"https://github.com/tonsky/rum\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">rum library</a> as wrapper for react, but these ideas can works with any view framework/library.\nI suppose you have already installed <a href=\"https://leiningen.org/#install\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">lein</a>.\nAlso I recommend to install <a href=\"https://github.com/hanslub42/rlwrap\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">rlwrap</a> for better experience. It can be done on OSX by <code class=\"language-text\">brew install rlwrap</code>.</p>\n<h2 id=\"concept\"><a href=\"#concept\" aria-label=\"concept permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Concept</h2>\n<p>This scheme represents dataflow in application.\n<a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/49054de8a06032ba7829fa7007810496/90e4b/flow.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 32.79395900755124%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAABOUlEQVQoz2VQ126DQBDk/78pylMi5SmWkCU7wpTEhWLg+gHmYLJHKslIp9OW2ZndAIRxmqCMgagbsLKE6ToUlxzhwyOSwwFCSGiqs7KCaFpIKXHT2lMxz/PqBT7ZFQUUF1BSQXIORc2aSCKOYW0HTbGimPs+RTVrMZAwSPgvloEDNcK5f8VbVa7j0wmYHBw54dcKjGI79iRAgkotwstA2sl7/1iB1v+Gz3/CV6dhgGNscZtmGfJLgVwUKHmFiXj+BZbs77dbVOWPG59L0xRvSYwkTtDZfjV4HEe6s8GRndB2DK1iEHSyumkQ7PcveN5sEIYhoiiCMZZO0yHLUux2O9w93ePMLtBOY3DD6gRudqj7BjkraLN5EQp+N3zZ/gt242h7hrPJEYkEsUxxoD+RGV71EVdeL9Y99x3MThrE2fb3rAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    ></span>\n    <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;box-shadow:inset 0px 0px 0px 400px white;\"\n        alt=\"Dataflow\"\n        title=\"flow\"\n        src=\"/static/49054de8a06032ba7829fa7007810496/623ee/flow.png\"\n        srcset=\"/static/49054de8a06032ba7829fa7007810496/816c5/flow.png 148w,\n/static/49054de8a06032ba7829fa7007810496/c766b/flow.png 295w,\n/static/49054de8a06032ba7829fa7007810496/623ee/flow.png 590w,\n/static/49054de8a06032ba7829fa7007810496/e5345/flow.png 885w,\n/static/49054de8a06032ba7829fa7007810496/90e4b/flow.png 927w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n  </span>\n  </a>\nWe have few entities here.</p>\n<ul>\n<li><strong>State</strong> – single atom of data. Keeps all app state not only data, but also UI state</li>\n<li><strong>Actions channel</strong> – <a href=\"https://clojure.github.io/core.async/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">core.async</a> channel. Pass actions one by one to transform</li>\n<li><strong>Transform</strong> – function that receives action, states value and returns new states value. This function is <strong>synchronous</strong></li>\n<li><strong>UI</strong> – can be DOM, React, Canvas etc.</li>\n<li>Other sources of actions. For example: timers, global handlers. If you use <a href=\"https://github.com/ptaoussanis/sente\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">sente</a> you can map and pipe it values to action channel.</li>\n</ul>\n<p>Rules is simple. If you want to change state you should dispatch an action. Action represents intention of changing data but doesn’t guarantee changing. Transform function always sync. It receives state and action and should return new state. If something should be done async transform <strong>should dispatch new action</strong>. That’s all. You always know when things happen and you always know where to put new code.</p>\n<p>I don’t use separate action creators. If you need complex request or data processing before dispatch action – it is just regular function.</p>\n<p>I don’t use any complex flows like <a href=\"https://github.com/redux-saga/redux-saga\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">redux-saga</a>. The problem they want to solve is to keep async operations in one place. It can be achieved with <code class=\"language-text\">&lt;!</code> macro in clojurescript.</p>\n<h2 id=\"create-project\"><a href=\"#create-project\" aria-label=\"create project permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create project</h2>\n<p>In shell run</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">lein new figwheel redux\n<span class=\"token function\">cd</span> redux</code></pre></div>\n<p>Project structure</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">.\n├── README.md\n├── dev\n│   └── user.clj\n├── project.clj\n├── resources\n│   └── public\n│       ├── css\n│       │   └── style.css\n│       └── index.html\n└── src\n    └── redux\n            └── core.cljs</code></pre></div>\n<p>Open <code class=\"language-text\">project.clj</code> file. Add rum to dependencies. Not it should looks like</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token operator\">:dependencies</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>org.clojure/clojure <span class=\"token string\">\"1.8.0\"</span><span class=\"token punctuation\">]</span>\n               <span class=\"token punctuation\">[</span>org.clojure/clojurescript <span class=\"token string\">\"1.9.229\"</span><span class=\"token punctuation\">]</span>\n               <span class=\"token punctuation\">[</span>org.clojure/core.async <span class=\"token string\">\"0.2.391\"</span>\n                <span class=\"token operator\">:exclusions</span> <span class=\"token punctuation\">[</span>org.clojure/tools.reader<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span>\n               <span class=\"token punctuation\">[</span>rum <span class=\"token string\">\"0.10.8\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span></code></pre></div>\n<p>Run <code class=\"language-text\">rlwrap lein figwheel</code> or <code class=\"language-text\">lein figwheel</code> for installing dependencies and repl session.\nOpen <a href=\"http://localhost:3449/index.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">http://localhost:3449/index.html</a>. You should see simple html template from server. Now we ready for coding.</p>\n<h2 id=\"coding-part-best-part\"><a href=\"#coding-part-best-part\" aria-label=\"coding part best part permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Coding part (best part)</h2>\n<p>We keep <code class=\"language-text\">resources/public/index.html</code> untouched</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token doctype\">&lt;!DOCTYPE html></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>html</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>head</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">charset</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>UTF-8<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>meta</span> <span class=\"token attr-name\">name</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>viewport<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">content</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>width=device-width, initial-scale=1<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>link</span> <span class=\"token attr-name\">href</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>css/style.css<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">rel</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>stylesheet<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/css<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>head</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>body</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>div</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>app<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>h2</span><span class=\"token punctuation\">></span></span>Figwheel template<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>h2</span><span class=\"token punctuation\">></span></span>\n      <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>p</span><span class=\"token punctuation\">></span></span>Checkout your developer console.<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>p</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>div</span><span class=\"token punctuation\">></span></span>\n    <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>script</span> <span class=\"token attr-name\">src</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>js/compiled/redux.js<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">type</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>text/javascript<span class=\"token punctuation\">\"</span></span><span class=\"token punctuation\">></span></span><span class=\"token script language-javascript\"></span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>script</span><span class=\"token punctuation\">></span></span>\n  <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>body</span><span class=\"token punctuation\">></span></span>\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>html</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>Create file <code class=\"language-text\">src/redux/flow.cljs</code> and fill it with</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">ns</span> redux.flow\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">:require</span> <span class=\"token punctuation\">[</span>cljs.core.async <span class=\"token operator\">:as</span> <span class=\"token number\">a</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">:require-macros</span> <span class=\"token punctuation\">[</span>cljs.core.async.macros <span class=\"token operator\">:refer</span> <span class=\"token punctuation\">[</span>go go-loop<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defonce</span> state <span class=\"token punctuation\">(</span>atom <span class=\"token punctuation\">{</span><span class=\"token operator\">:name</span> <span class=\"token string\">\"World\"</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defonce</span> actions <span class=\"token punctuation\">(</span><span class=\"token number\">a</span>/chan<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">;; Components call this function to request state changing.</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> dispatch\n  <span class=\"token string\">\"Dispatch new action. Type should be keyword.\"</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>type<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">(</span>dispatch type <span class=\"token boolean\">nil</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>type data<span class=\"token punctuation\">]</span>\n   <span class=\"token punctuation\">(</span><span class=\"token number\">a</span>/put! actions <span class=\"token punctuation\">[</span>type data<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">;; All state changes should be done via this method.</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defmulti</span> transform\n  <span class=\"token string\">\"Transform state by action. Return updated state.\"</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">fn</span> <span class=\"token punctuation\">[</span>state data dispatch action-type<span class=\"token punctuation\">]</span> action-type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">;; Start actions pipeline</span>\n<span class=\"token punctuation\">(</span>go-loop <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n         <span class=\"token punctuation\">(</span><span class=\"token keyword\">when-let</span> <span class=\"token punctuation\">[</span><span class=\"token number\">a</span> <span class=\"token punctuation\">(</span><span class=\"token number\">a</span>/<span class=\"token keyword\">&lt;</span>! actions<span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n           <span class=\"token punctuation\">(</span><span class=\"token keyword\">let</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">[</span>type data<span class=\"token punctuation\">]</span> <span class=\"token number\">a</span><span class=\"token punctuation\">]</span>\n             <span class=\"token punctuation\">(</span><span class=\"token keyword\">println</span> <span class=\"token string\">\"Handle action\"</span> type<span class=\"token punctuation\">)</span>\n             <span class=\"token punctuation\">(</span>swap! state transform data dispatch type<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n          <span class=\"token punctuation\">(</span><span class=\"token keyword\">recur</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>As you can see we define state and actions channel with <code class=\"language-text\">defonce</code> – it helps to keep data between code reloads.\n<code class=\"language-text\">go-loop</code> is used to receive actions from channel.\nNotice than we have <code class=\"language-text\">transform</code> multimethod, but we don’t have any implementation. We will add them latter.</p>\n<p>Create <code class=\"language-text\">src/redux/components.cljs</code></p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">ns</span> redux.components\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">:require</span> <span class=\"token punctuation\">[</span>rum.core <span class=\"token operator\">:as</span> r<span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">[</span>clojure.string <span class=\"token operator\">:as</span> <span class=\"token keyword\">str</span><span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">[</span>redux.flow <span class=\"token operator\">:refer</span> <span class=\"token punctuation\">[</span>dispatch<span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>r/<span class=\"token number\">defc</span> +form\n  <span class=\"token punctuation\">[</span>state<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">[</span>:.app\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:h1</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">str</span> <span class=\"token string\">\"Hello, \"</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">:name</span> state<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span>\n   <span class=\"token punctuation\">[</span><span class=\"token operator\">:input</span> <span class=\"token punctuation\">{</span><span class=\"token operator\">:value</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">:name</span> state<span class=\"token punctuation\">)</span>\n            <span class=\"token operator\">:on-change</span> #<span class=\"token punctuation\">(</span>dispatch <span class=\"token operator\">:change-name</span> <span class=\"token punctuation\">(</span><span class=\"token keyword\">..</span> % -target -value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>r/<span class=\"token number\">defc</span> +app <span class=\"token keyword\">&lt;</span> r/reactive\n  <span class=\"token punctuation\">[</span>state-atom<span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span>+form <span class=\"token punctuation\">(</span>r/react state-atom<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>It renders header and input with name from the state. Notice <code class=\"language-text\">on-change</code> handler. It doesn’t change the state directly (and it can’t do because state map is immutable). Instead of it calls dispatch.</p>\n<p>Sometimes you don’t want to pass state through the components tree. In this case you can use <code class=\"language-text\">redux.flow/state</code> directly, but don’t change it. For a big codebase you can add getter.</p>\n<p>Last part is the <code class=\"language-text\">src/redux/core.cljs</code> file. It ties all things together and provides start point plus some dev tools.</p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">ns</span> redux.core\n  <span class=\"token punctuation\">(</span><span class=\"token operator\">:require</span> <span class=\"token punctuation\">[</span>redux.components <span class=\"token operator\">:as</span> components<span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">[</span>redux.flow <span class=\"token operator\">:as</span> flow<span class=\"token punctuation\">]</span>\n            <span class=\"token punctuation\">[</span>rum.core <span class=\"token operator\">:as</span> rum<span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token punctuation\">(</span>enable-console-print!<span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">;; Attach react tree to DOM</span>\n<span class=\"token punctuation\">(</span>rum/mount <span class=\"token punctuation\">(</span>components/+app flow/state<span class=\"token punctuation\">)</span>\n           <span class=\"token punctuation\">(</span>js/document.getElementById <span class=\"token string\">\"app\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token comment\">;; Dev helper. It touches state when code reloaded to start rerender.</span>\n<span class=\"token punctuation\">(</span><span class=\"token keyword\">defn</span> on-js-reload <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>\n  <span class=\"token punctuation\">(</span>swap! flow/state update-in <span class=\"token punctuation\">[</span>:__figwheel_counter<span class=\"token punctuation\">]</span> <span class=\"token keyword\">inc</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>Last thing we need is transform for <code class=\"language-text\">:change-name</code> action. Add this code to the bottom of <code class=\"language-text\">src/redux/flow.cljs</code></p>\n<div class=\"gatsby-highlight\" data-language=\"clojure\"><pre class=\"language-clojure\"><code class=\"language-clojure\"><span class=\"token punctuation\">(</span><span class=\"token keyword\">defmethod</span> transform <span class=\"token operator\">:change-name</span>\n  <span class=\"token punctuation\">[</span>state value<span class=\"token punctuation\">]</span>\n  <span class=\"token comment\">;; State here is map, not atom!</span>\n  <span class=\"token punctuation\">(</span><span class=\"token keyword\">assoc</span> state <span class=\"token operator\">:name</span> value<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>All state changes should live in methods like this one.</p>\n<h2 id=\"summary\"><a href=\"#summary\" aria-label=\"summary permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Summary</h2>\n<p>This data workflow is simple enough and any developer can start write nice code after few hours of reading project. Downside is boilerplate code you need to write sometimes. But it easy to write helpers for these stuff leave flow itself untouched.</p>\n<p>Next good part: this flow plays well with <a href=\"http://slonoed.net/clojure-render-react\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">server render</a>.</p>\n<p>In the next post I’ll show how to include async requests and channels into this flow.</p>\n<p>You can find source code in <a href=\"https://github.com/slonoed/blog-redux-in-closurescript-with-rum\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">my github</a>.</p>","timeToRead":6,"frontmatter":{"title":"Redux in clojurescript with rum","date":"January 20, 2017","description":null},"fields":{"slug":"/redux-in-closurescript-with-rum/","langKey":"en"}},"altPost":null},"pageContext":{"slug":"/redux-in-closurescript-with-rum/","altSlug":"/ru/redux-in-closurescript-with-rum/"}}