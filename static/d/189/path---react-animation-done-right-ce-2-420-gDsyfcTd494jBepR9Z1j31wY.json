{"data":{"site":{"siteMetadata":{"title":"slonoed","author":"Dmitry Manannikov","siteUrl":"https://slonoed.net"}},"markdownRemark":{"id":"b33179d0-131f-5ee8-8b5e-654c943cc8e1","html":"<p><em>TL;DR use Web Animation API. Works only in Chrome, FF</em></p>\n<p>There are some ways to animate DOM elements.\nThe most old is the <a href=\"http://api.jquery.com/animate/\" title=\"jQuery .animate()\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">jQuery .animate()</a>. Back in time it gave\nweb-developers the holy grail: nice API and perfect browser support.</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token function\">$</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#book\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">animate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n  opacity<span class=\"token punctuation\">:</span> <span class=\"token number\">0.25</span><span class=\"token punctuation\">,</span>\n  left<span class=\"token punctuation\">:</span> <span class=\"token string\">\"+=50\"</span><span class=\"token punctuation\">,</span>\n  height<span class=\"token punctuation\">:</span> <span class=\"token string\">\"toggle\"</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5000</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">function</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token comment\">// Animation completed</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>The animation is calculated in JS, which is both a plus (cross-browser) and a\nsignificant disadvantage regarding performance. Any complex animation started\nto slow down on a weak processor.</p>\n<p>There are other libraries that use JS for DOM elements animations. Pros and cons\nare the same.</p>\n<h2 id=\"css-to-the-rescue\"><a href=\"#css-to-the-rescue\" aria-label=\"css to the rescue permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>CSS to the rescue</h2>\n<p>It was obvious that a way was needed to enable the creation of performant\nanimation, which could be accelerated by hardware. That’s why specification\n<a href=\"https://www.w3.org/TR/css3-animations/\" title=\"CSS3 animation\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">css3-animations</a> was created.</p>\n<p>The main difference was the declarative syntax based on CSS, which could\ndescribe the behavior of the elements. There are many advantages to this method.\nThe main one is the  support for hardware acceleration for obtaining 60 fps\nfor animations. The downside is that it’s extremely inconvenient to use such\nanimations from JS.</p>\n<p>For example, to do something after the end of the animation, you have to listen\nthe <code class=\"language-text\">animationend</code> and<code class=\"language-text\">webkitAnimationEnd</code> events on the element.</p>\n<h2 id=\"react-way\"><a href=\"#react-way\" aria-label=\"react way permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>React way</h2>\n<p>From the very beginning, the developers of React suggested the way to animate components\nby setting the CSS classes to elements. And to handle addition and removal of\nelements they event created <a href=\"https://facebook.github.io/react/docs/animation.html\" title=\"React Animation Add-Ons\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">addon</a>, which looks totally weird.</p>\n<p>Here is an example from the official documentation:</p>\n<div class=\"gatsby-highlight\" data-language=\"html\"><pre class=\"language-html\"><code class=\"language-html\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>ReactCSSTransitionGroup</span>\n    <span class=\"token attr-name\">transitionName</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span><span class=\"token punctuation\">\"</span>example<span class=\"token punctuation\">\"</span></span>\n    <span class=\"token attr-name\">transitionEnterTimeout</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{500}</span>\n    <span class=\"token attr-name\">transitionLeaveTimeout</span><span class=\"token attr-value\"><span class=\"token punctuation\">=</span>{300}</span><span class=\"token punctuation\">></span></span>\n    {items}\n<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>ReactCSSTransitionGroup</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<p>In addition to the component, you need to describe CSS:</p>\n<div class=\"gatsby-highlight\" data-language=\"css\"><pre class=\"language-css\"><code class=\"language-css\"><span class=\"token selector\">.example-enter</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 0.01<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.example-enter.example-enter-active</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 1<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">transition</span><span class=\"token punctuation\">:</span> opacity 500ms ease-in<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.example-leave</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 1<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token selector\">.example-leave.example-leave-active</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token property\">opacity</span><span class=\"token punctuation\">:</span> 0.01<span class=\"token punctuation\">;</span>\n  <span class=\"token property\">transition</span><span class=\"token punctuation\">:</span> opacity 300ms ease-in<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>There are different kinds of libraries that work similarly.</p>\n<h2 id=\"web-animations-api\"><a href=\"#web-animations-api\" aria-label=\"web animations api permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Web Animations API</h2>\n<p>Blink based browsers and Firefox already have the support for a new way to animate\nIn Blink based browsers (Chrome, Opera, etc.) and in Firefox there is already\nelements —  <a href=\"https://w3c.github.io/web-animations/\" title=\"Web animations API spec\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Web Animations API</a>.</p>\n<p>The component code can be:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> style <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n  background<span class=\"token punctuation\">:</span> <span class=\"token string\">'#f49'</span><span class=\"token punctuation\">,</span>\n  width<span class=\"token punctuation\">:</span> <span class=\"token string\">'100px'</span><span class=\"token punctuation\">,</span>\n  height<span class=\"token punctuation\">:</span> <span class=\"token string\">'100px'</span><span class=\"token punctuation\">,</span>\n  margin<span class=\"token punctuation\">:</span> <span class=\"token string\">'50px auto'</span><span class=\"token punctuation\">,</span>\n  color<span class=\"token punctuation\">:</span> <span class=\"token string\">'white'</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">Animated</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">React<span class=\"token punctuation\">.</span>Component</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token function\">run</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>el<span class=\"token punctuation\">.</span><span class=\"token function\">animate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span> transform<span class=\"token punctuation\">:</span> <span class=\"token string\">'scale(1)'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span> transform<span class=\"token punctuation\">:</span> <span class=\"token string\">'scale(1.3)'</span> <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">{</span> transform<span class=\"token punctuation\">:</span> <span class=\"token string\">'scale(1)'</span> <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n        duration<span class=\"token punctuation\">:</span> <span class=\"token number\">400</span><span class=\"token punctuation\">,</span>\n        iterations<span class=\"token punctuation\">:</span> <span class=\"token number\">3</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token function\">render</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token operator\">&lt;</span>div onClick<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>run<span class=\"token punctuation\">.</span><span class=\"token function\">bind</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">this</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">}</span> ref<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>e <span class=\"token operator\">=></span> <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>el <span class=\"token operator\">=</span> e<span class=\"token punctuation\">}</span> style<span class=\"token operator\">=</span><span class=\"token punctuation\">{</span>style<span class=\"token punctuation\">}</span><span class=\"token operator\">></span>\n      Click me<span class=\"token operator\">!</span>\n    <span class=\"token operator\">&lt;</span><span class=\"token operator\">/</span>div<span class=\"token operator\">></span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><a href=\"https://codesandbox.io/s/4z1768j30x\" title=\"Пример\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Live example</a>.</p>\n<p>In addition, to the declarative description of the animation, the execution time\nand the number of repetitions, you can specify the start delay, the type of\nanimation, and other properties, which can be specified in CSS.</p>\n<p><code class=\"language-text\">Element.animate</code> returns an object of the type <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Animation\" title=\"Animation\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">Animation</a>. Which can\nbe used to:</p>\n<ul>\n<li>\n<p>Subscribe to animation finish (with Promise)</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">const</span> animation <span class=\"token operator\">=</span> element<span class=\"token punctuation\">.</span><span class=\"token function\">animate</span><span class=\"token punctuation\">(</span>keyframes<span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span>\nanimation<span class=\"token punctuation\">.</span>finished<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\nconsole<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Done!'</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p>Cancel animation</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">animation<span class=\"token punctuation\">.</span><span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p>Or event play it reversed</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">animation<span class=\"token punctuation\">.</span><span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></code></pre></div>\n</li>\n<li>\n<p>Other cool stuff</p>\n</li>\n</ul>\n<h2 id=\"conclusion\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>Web animations API are a powerful animation management tool for JavaScript.\nIt is extremely useful in the React components.</p>\n<p>Unfortunately, given the support of browsers, it is impossible to use this method\nin production in most cases. However, if you are lucky and need to support only\nChrome and FF, then <code class=\"language-text\">Element.animate</code> can be a good helper.</p>","timeToRead":3,"frontmatter":{"title":"React animation done right","date":"September 08, 2017","description":"Create performant React animation with Web Animations API"},"fields":{"slug":"/react-animation-done-right/","langKey":"en"}},"altPost":{"id":"e1e0a05d-1bd3-553e-86e6-4fea68ef9401","fields":{"slug":"/ru/react-animation-done-right/","langKey":"ru"}}},"pageContext":{"slug":"/react-animation-done-right/","altSlug":"/ru/react-animation-done-right/"}}